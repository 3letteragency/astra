#+TITLE: Astra Docs and Planning
#+DESCRIPTION: Astra is a mission control framework for KSP to facilitate fully automated missions and operations. Also hoping to learn a bit about control theory in the process.
#+AUTHOR: Tyler Weldon
#+EMAIL: tylerweldon94@gmail.com

* Astra
** STRT R&D [2/2]
- [X] Can we set up a headless/graphically limited KSP?
  * +Running KSP in a VM seems promising.+
    * +Set all graphics settings to minimum+
  * We sure can! Unity options: ~~KSP.x86_64 -batchmode -nographics~~
- [X] If not headless, can we automate the launching of KSP "instances", and entering/setting up the game as desired(specific missions, locations, etc.) via the [[https://krpc.github.io/krpc/cpp/api/ui/ui.html][kRPC UI API]]?
  * +Might be able to use the Unity [[https://docs.unity3d.com/Manual/CLIBatchmodeCoroutines.html][Batch Mode]] and [[https://docs.unity3d.com/Manual/CommandLineArguments.html][nographics]] options to facilitate headless.+
  * +Will need some means of automatically launching specified game saves.+
    * +[[https://github.com/allista/AutoLoadGame][AutoLoadGame]] might do the trick.+
      * +Might modify to use Unity CLI args instead of config file:+
        + https://answers.unity.com/questions/138715/read-command-line-arguments.html
        + https://answers.unity.com/questions/366195/parameters-at-startup.html
  * No longer neccessary, headless is possible w/ unity opts in above task
** STRT Stage 1 - Prep [1/7]
- [ ] Pin KSP to 1.7.3
- [ ] Get KSP 1.7.3 running
- [ ] Install mods via CKAN
- [ ] Load Arbitrary SFS via cli args(modded version of AutoLoadGame)
- [ ] SFS File that autostarts kRPCServer
- [ ] Load Arbitrary b64 encoded SFS(w/ kRPC autostarted) via userdata
- [X] Choose kRPC client language - C++
** TODO Stage 2 - Data [0/1]
- [ ] Set up client w/ all kRPC Data Stream - Once this is done, revisiting the image build will probably be worth it.
  * Pipe into GMAT and OpenMCT ???
** TODO Stage 3 - RL Software integrations [0/2]
- [ ] [[https://opensource.gsfc.nasa.gov/projects/GMAT/index.php][GMAT]] - Planning
- [ ] [[https://github.com/nasa/openmct][OpenMCT]] - Ops HUD
** TODO Stage 4 - Operations [0/2]
- [-] Starlink(s) [0/0]
- [-] Long running, real time ops [0/0]
** TODO Stage 5 - Stream Real Time Ops [0/0]
** KSP Mod Requirements
- [[https://krpc.github.io/krpc/][kRPC]] - kRPC allows you to control Kerbal Space Program from scripts running outside of the game.
- [[https://github.com/KSP-RO/RealismOverhaul/wiki][Realism Overhaul]] - Its not certain this will place nice with [[https://krpc.github.io/krpc/][kRPC]], however realistic(ish?) control theory is really the purpose of this project so we will proceed with it until/unless we encounter problems.
- [[https://ksp-kos.github.io/KOS/][kOS]] - kOS might be useful for some simpler tasks where we don't want the full power of kRPC. Might use, might not. We'll see.
** On Hold
  - [X] Do I even want to use KSP? This [[http://orbit.medphys.ucl.ac.uk/index.html][Orbiter Space flight simulator]] seems interesting:
    * Results: perhaps I'll work up to this at some point...
    * [[https://www.orbiterwiki.org/wiki/][Docs]]
    * [[https://www.orbiterwiki.org/wiki/SDK_documentation][SDK Docs]]
  - [ ] Automate S3 hosting of tar'd game download
    * On Hold: Can just use steam cmd locally for now to create the tars then automate the uploading/point packer builds to the "latest" tar.
    * No Steam DRM on KSP, should be able to move this around/host in S3 however I need. No direct DL necessary, and should negate the need for steamcmd in the Game Packer build.
    * Will be nice to automate, but is not strictly necessary and would only need to be done on game updates.
    * If ever necessary can provide "depot" and manifest ID's to steamcmd to DL specific KSP releases.
  - [-] Base VM Image(Packer) [3/8] - On hold, image building is taking too much time and is not very clean to automate with steamcmd atm. Will need to revisit once project is further along. Not currently worth pursuing, better to get some real work done.
    - [ ] KSP Needs to be pinned to 1.7.3 for compatibility between both kRPC and RO :(
    - [ ] Userdata json structure for:
      * b64 encoded sfs
      * Authorized keys
    - [ ] Automate version bumping on every build and passing down version variable to other locations(i.e. TF plans snapshot string variables)
    - [X] Add ssh key
    - Ubuntu base image
    - Vultr builder
    - KSP Archive is uploaded to build server from local
    - [X] CLI Steam management - steamcmd works
      * +Make sure deb frontend noninteractive works+
      * +Non-interactive steamcmd+
      * +Missing some 32bit libs by default+
      * +2fa?+
      * +Otherwise, seems to work just fine then directly launch with the binary installed in ~/.steam/...+
      * +As an alternative should we run into unfixable issues w/ steam, direct download from Squad and hosting that in a private s3 should be fine.+
    - [X] KSP Installed
    - [ ] Loads arbitrary sfs game [0/3]
      - [ ] Rework [[https://github.com/krpc/krpc/blob/master/tools/TestingTools/src/AutoLoadGame.cs][AutoLoadGame]] from kRPC to take sfs filename string as commandline arg to ~~KSP.x86_64~~
      - [ ] Figure out how to write sfs/scenario files for your base
      - [ ] kRPC AutoStarts and listening on 0.0.0.0
        * Is it possible to set this via the SFS File? Might need to extend here.
    - [ ] Mods installed
  - [-] Split Project into multiple repos [0/1] - Similar to Packer build, not currently worth pursuing till a greater bulk of work is done.
    - [ ] Terraform [0/2]
      - [ ] Modules
      - [ ] Plans
