{
  "variables": {
    "astra_node_version": "{{ env `ASTRA_NODE_VERSION` }}",
    "vultr_api_key": "{{ env `VULTR_API_KEY` }}",
    "game_archive_url": "{{ env `GAME_ARCHIVE_URL` }}"
  },
  "builders": [
    {
      "type": "vultr",
      "api_key": "{{ user `vultr_api_key` }}",
      "os_id": 387,
      "region_id": 1,
      "plan_id": 201,
      "snapshot_description": "{{ user `astra_node_version` }}",
      "ssh_username": "root",
      "ssh_key_ids": [
        "5f5507ed4d724"
      ],
      "state_timeout": "20m",
      "instance_label": "{{ user `astra_node_version` }}",
      "hostname": "astra-node"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "environment_vars": [
        "GAME_ARCHIVE_URL={{ user `game_archive_url` }}"
      ],
      "inline": [
        "apt -y update",
        "apt -y install mono-runtime",
        "useradd -m astra",
        "wget $GAME_ARCHIVE_URL -O /tmp/ksp.tar.gz",
        "tar -xzvf /tmp/ksp.tar.gz -C /home/astra --strip-components=2"
      ]
    }
  ]
}
